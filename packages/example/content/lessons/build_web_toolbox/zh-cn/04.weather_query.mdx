---
title: å¤©æ°”æŸ¥è¯¢åŠŸèƒ½å®ç°
description: å®ç°å¤©æ°”æŸ¥è¯¢é¡µé¢ã€å¤©æ°”å¡ç‰‡ç»„ä»¶å’ŒåŸå¸‚æœç´¢åŠŸèƒ½
---

import Tabs from '@components/tabs/Tabs.astro';
import TabItem from '@components/tabs/TabItem.astro';

<Tabs>
  <TabItem label="æ’æ˜Ÿ">å¤©ç‹¼æ˜Ÿï¼Œç»‡å¥³æ˜Ÿï¼Œå‚å®¿å››</TabItem>
  <TabItem label="å«æ˜Ÿ">æœ¨å«ä¸€ï¼Œæœ¨å«äºŒï¼Œæœ¨å«ä¸‰</TabItem>
</Tabs>

åœ¨è¿™ä¸€èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†å®ç°ä¸€ä¸ªå®Œæ•´çš„å¤©æ°”æŸ¥è¯¢åŠŸèƒ½ã€‚ä¸»è¦åŒ…æ‹¬ä»¥ä¸‹å†…å®¹ï¼š

1. è®¾è®¡å’Œå®ç°å¤©æ°”æŸ¥è¯¢é¡µé¢
2. åˆ›å»ºå¤©æ°”å¡ç‰‡ç»„ä»¶
3. é›†æˆèšåˆæ•°æ®å¤©æ°” API
4. å®ç°åŸå¸‚æœç´¢åŠŸèƒ½

![weather_query](./images/3.png)

## å‡†å¤‡å·¥ä½œ

å…¶ä¸­çš„æ•°æ®æ¥è‡ªäºï¼š[èšåˆæ•°æ®](https://www.juhe.cn/)ï¼Œè¿™æ˜¯å›½å†…ä¸€ä¸ªéå¸¸ä¸é”™çš„æ•°æ®ä¾›åº”å•†ï¼Œæä¾›äº†å¾ˆå¤šå…è´¹çš„æ•°æ®æ¥å£ã€‚

![juhe](./images/4.png)

1. æ³¨å†Œèšåˆæ•°æ®è´¦å·å¹¶è·å– API Keyï¼š
   - è®¿é—® [èšåˆæ•°æ®å®˜ç½‘](https://www.juhe.cn/)
   - æ³¨å†Œè´¦å·å¹¶å®åè®¤è¯
   - ç”³è¯·å¤©æ°”é¢„æŠ¥ API
   - è·å– API Key

2. åˆ›å»ºç¯å¢ƒå˜é‡æ–‡ä»¶ï¼š

```bash
# .env
JUHE_WEATHER_KEY=your_api_key_here
```

## ç»„ä»¶å®ç°

æ¥ä¸‹æ¥çš„ä»£ç å¯ä»¥ç”± AI ç”Ÿæˆï¼Œä½ å¯ä»¥è¿™æ ·å¯¹ AI è¯´ï¼š

```bash
ç”Ÿæˆä¸€ä¸ªå¤©æ°”å¡ç‰‡ç»„ä»¶ï¼Œè¦æ±‚ï¼š
- ä½¿ç”¨ TailwindCSS å’Œ DaisyUI å®ç°å¤©æ°”å¡ç‰‡ç»„ä»¶
- ä½¿ç”¨ Astro å®ç°å¤©æ°”å¡ç‰‡ç»„ä»¶ï¼Œå¹¶æ·»åŠ å¤©æ°”æ•°æ®
- ä»£ç å†™å…¥ src/components/WeatherCard.astro æ–‡ä»¶ä¸­

ç”Ÿæˆä¸€ä¸ªå¤©æ°”æŸ¥è¯¢é¡µé¢ï¼Œè¦æ±‚ï¼š
- ä½¿ç”¨ Vue å®ç°å¤©æ°”æŸ¥è¯¢é¡µé¢
- ä½¿ç”¨ Astro å®ç°å¤©æ°”æŸ¥è¯¢é¡µé¢ï¼Œå¹¶æ·»åŠ å¤©æ°”æ•°æ®
- ä»£ç å†™å…¥ src/components/WeatherPage.astro æ–‡ä»¶ä¸­
```

ä»¥ä¸‹æ˜¯æˆ‘å¾—åˆ°çš„ä»£ç ï¼Œä¾›ä½ å‚è€ƒï¼š
<Tabs>
<TabItem label="å¤©æ°”å¡ç‰‡ç»„ä»¶">
```vue
<!-- components/WeatherCard.vue -->
<script setup lang="ts">
import { computed } from 'vue'

// å®šä¹‰ç»„ä»¶å±æ€§
interface Props {
  weather: {
    city: string
    date: string
    temperature: string
    weather: string
    wind: string
    humidity: string
  }
}

const props = defineProps<Props>()

// æ ¹æ®å¤©æ°”çŠ¶å†µé€‰æ‹©å›¾æ ‡
const weatherIcon = computed(() => {
  const weather = props.weather.weather
  if (weather.includes('æ™´')) return 'â˜€ï¸'
  if (weather.includes('å¤šäº‘')) return 'â›…'
  if (weather.includes('é˜´')) return 'â˜ï¸'
  if (weather.includes('é›¨')) return 'ğŸŒ§ï¸'
  if (weather.includes('é›ª')) return 'ğŸŒ¨ï¸'
  return 'ğŸŒ¤ï¸'
})
</script>

<template>
  <div class="card w-96 bg-base-200 shadow-xl">
    <div class="card-body">
      <h2 class="card-title text-2xl">
        {{ weather.city }}
        <span class="text-3xl">{{ weatherIcon }}</span>
      </h2>
      <div class="text-lg space-y-2">
        <p>{{ weather.date }}</p>
        <p>æ¸©åº¦ï¼š{{ weather.temperature }}â„ƒ</p>
        <p>å¤©æ°”ï¼š{{ weather.weather }}</p>
        <p>é£å†µï¼š{{ weather.wind }}</p>
        <p>æ¹¿åº¦ï¼š{{ weather.humidity }}</p>
      </div>
    </div>
  </div>
</template>
```
</TabItem>
<TabItem label="å¤©æ°”æŸ¥è¯¢é¡µé¢">
```vue 
<!-- components/WeatherPage.vue -->
<script setup lang="ts">
import { ref } from 'vue'
import WeatherCard from './WeatherCard.vue'

// çƒ­é—¨åŸå¸‚
const popularCities = [
  'åŒ—äº¬',
  'ä¸Šæµ·',
  'å¹¿å·',
  'æ·±åœ³',
  'æ­å·',
  'æˆéƒ½',
  'æ­¦æ±‰',
  'è¥¿å®‰'
]

// å“åº”å¼çŠ¶æ€
const searchQuery = ref('åŒ—äº¬')
const searchResults = ref([])
const selectedCity = ref('')
const loading = ref(false)
const error = ref('')
const weatherData = ref(null)

// æœç´¢åŸå¸‚
async function searchCity() {
  if (!searchQuery.value) return

  try {
    loading.value = true
    error.value = ''

    // è°ƒç”¨åŸå¸‚æœç´¢ API
    const response = await fetch(`/api/weather/cities?query=${encodeURIComponent(searchQuery.value)}`)
    const data = await response.json()

    if (data.error) {
      error.value = data.error
      return
    }

    searchResults.value = data.cities
  } catch (e) {
    error.value = 'æœç´¢å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•'
  } finally {
    loading.value = false
  }
}

// è·å–å¤©æ°”æ•°æ®
async function getWeather(city: string) {
  console.log('getWeather', city)
  try {
    loading.value = true
    error.value = ''
    selectedCity.value = city
    searchQuery.value = ''
    searchResults.value = []

    // è°ƒç”¨å¤©æ°”æŸ¥è¯¢ API
    const response = await fetch(`/api/weather?city=${city}`)
    const data = await response.json()

    if (data.error) {
      error.value = data.error
      return
    }

    weatherData.value = data
  } catch (e) {
    error.value = 'è·å–å¤©æ°”ä¿¡æ¯å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•'
  } finally {
    loading.value = false
  }
}
</script>

<template>
  <div class="max-w-4xl mx-auto">
    <h1 class="text-3xl font-bold mb-8">å¤©æ°”æŸ¥è¯¢</h1>

    <!-- æœç´¢æ¡† -->
    <div class="form-control w-full max-w-lg mb-8">
      <div class="input-group flex flex-row gap-2">
        <input v-model="searchQuery" type="text" placeholder="è¾“å…¥åŸå¸‚åç§°..." class="input input-bordered w-full"
          @input="searchCity" />
        <button class="btn btn-primary" :disabled="loading" @click="searchCity">
          æœç´¢
        </button>
      </div>

      <!-- æœç´¢ç»“æœ -->
      <ul v-if="searchResults.length > 0" class="menu bg-base-200 w-full mt-2 rounded-box">
        <li v-for="city in searchResults" :key="city">
          <a @click="getWeather(city)">{{ city }}</a>
        </li>
      </ul>

      <!-- é”™è¯¯æç¤º -->
      <div v-if="error" class="alert alert-error mt-4">
        {{ error }}
      </div>
    </div>

    <!-- çƒ­é—¨åŸå¸‚ -->
    <div class="mb-8">
      <h2 class="text-xl font-bold mb-4">çƒ­é—¨åŸå¸‚</h2>
      <div class="flex flex-wrap gap-2">
        <button v-for="city in popularCities" :key="city" class="btn btn-outline" @click="getWeather(city)">
          {{ city }}
        </button>
      </div>
    </div>

    <!-- å¤©æ°”ä¿¡æ¯ -->
    <div v-if="weatherData" class="flex justify-center">
      <WeatherCard :weather="weatherData" />
    </div>

    <!-- åŠ è½½çŠ¶æ€ -->
    <div v-if="loading" class="flex justify-center items-center h-40">
      <span class="loading loading-spinner loading-lg"></span>
    </div>
  </div>
</template>
```

</TabItem>
</Tabs>

## Astro é¡µé¢é›†æˆ

åˆ›å»º Astro é¡µé¢æ¥ä½¿ç”¨ WeatherCard ç»„ä»¶ï¼Œä½ å¯ä»¥è¿™æ ·å¯¹ AI è¯´ï¼š

```bash
ç”Ÿæˆä¸€ä¸ª Astro é¡µé¢ï¼Œè¦æ±‚ï¼š
- ä½¿ç”¨ Astro å®ç°å¤©æ°”æŸ¥è¯¢é¡µé¢ï¼Œå¹¶æ·»åŠ å¤©æ°”æ•°æ®
- è¦ä½¿ç”¨ WeatherCard å’Œ WeatherPage ç»„ä»¶
- ä»£ç å†™å…¥ src/pages/weather/index.astro æ–‡ä»¶ä¸­
```

ä»¥ä¸‹æ˜¯æˆ‘å¾—åˆ°çš„ä»£ç ï¼Œä¾›ä½ å‚è€ƒï¼š

```astro
<!-- pages/weather/index.astro -->
---
import AppLayout from '../../layouts/AppLayout.astro'
import WeatherCard from '../../components/WeatherCard.vue'

// ç¤ºä¾‹å¤©æ°”æ•°æ®
const exampleWeather = {
  city: 'åŒ—äº¬',
  date: new Date().toLocaleDateString('zh-CN'),
  temperature: '25',
  weather: 'æ™´',
  wind: 'ä¸œåŒ—é£ 3çº§',
  humidity: '45%'
}
---

<AppLayout>
  <div class="max-w-4xl mx-auto">
    <h1 class="text-3xl font-bold mb-8">å¤©æ°”æŸ¥è¯¢</h1>
    
    <!-- ä½¿ç”¨ Vue ç»„ä»¶ -->
    <div class="flex justify-center">
      <WeatherCard client:load weather={exampleWeather} />
    </div>
    
    <div class="mt-8 text-center text-gray-600">
      <p>è¿™æ˜¯ä¸€ä¸ªç¤ºä¾‹å±•ç¤ºï¼Œå®Œæ•´åŠŸèƒ½è¯·å‚è€ƒä¸Šæ–¹ Vue ç»„ä»¶çš„å®ç°ã€‚</p>
    </div>
  </div>
</AppLayout>
```

åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼š

1. ä½¿ç”¨ `client:load` æŒ‡ä»¤ç¡®ä¿ç»„ä»¶åœ¨å®¢æˆ·ç«¯åŠ è½½æ—¶è¿›è¡Œæ°´åˆï¼ˆhydrationï¼‰
2. é€šè¿‡ props ä¼ é€’å¤©æ°”æ•°æ®åˆ° Vue ç»„ä»¶
3. ä½¿ç”¨ AppLayout ä¿æŒé¡µé¢å¸ƒå±€ä¸€è‡´
4. æ·»åŠ å“åº”å¼æ ·å¼ç¡®ä¿è‰¯å¥½çš„å±•ç¤ºæ•ˆæœ

## API è·¯ç”±å®ç°

åœ¨ `src/pages/api` ç›®å½•ä¸‹åˆ›å»ºå¤©æ°”ç›¸å…³çš„ API è·¯ç”±ï¼Œä½ å¯ä»¥è¿™æ ·å¯¹ AI è¯´ï¼š

```bash
ç”Ÿæˆä¸€ä¸ªå¤©æ°”æŸ¥è¯¢æ¥å£ï¼Œè¦æ±‚ï¼š
- ä½¿ç”¨ Astro å®ç°å¤©æ°”æŸ¥è¯¢æ¥å£ï¼Œå¹¶æ·»åŠ å¤©æ°”æ•°æ®
- ä½¿ç”¨èšåˆæ•°æ®å¤©æ°” API è·å–å¤©æ°”æ•°æ®
- ä»£ç å†™å…¥ src/pages/api/weather/index.ts æ–‡ä»¶ä¸­

ç”Ÿæˆä¸€ä¸ªåŸå¸‚æœç´¢æ¥å£ï¼Œè¦æ±‚ï¼š
- ä½¿ç”¨ Astro å®ç°åŸå¸‚æœç´¢æ¥å£ï¼Œå¹¶æ·»åŠ åŸå¸‚æ•°æ®
- ä»£ç å†™å…¥ src/pages/api/weather/cities.ts æ–‡ä»¶ä¸­
```

ä»¥ä¸‹æ˜¯æˆ‘å¾—åˆ°çš„ä»£ç ï¼Œä¾›ä½ å‚è€ƒï¼š

<Tabs>
<TabItem label="å¤©æ°”æŸ¥è¯¢æ¥å£">

```ts
// pages/api/weather/index.ts
import type { APIRoute } from 'astro'

interface WeatherResponse {
  city: string
  date: string
  temperature: string
  weather: string
  wind: string
  humidity: string
}

export const GET: APIRoute = async ({ request }) => {
  try {
    const url = new URL(request.url)
    const city = url.searchParams.get('city')

    if (!city) {
      return new Response(
        JSON.stringify({
          error: 'è¯·æä¾›åŸå¸‚åç§°'
        }),
        { status: 400 }
      )
    }

    const JUHE_WEATHER_KEY = import.meta.env.JUHE_WEATHER_KEY
    const apiUrl = `http://apis.juhe.cn/simpleWeather/query?city=${encodeURIComponent(city)}&key=${JUHE_WEATHER_KEY}`

    const response = await fetch(apiUrl)
    const data = await response.json()

    if (data.error_code !== 0) {
      return new Response(
        JSON.stringify({
          error: data.reason || 'è·å–å¤©æ°”ä¿¡æ¯å¤±è´¥'
        }),
        { status: 500 }
      )
    }

    const weatherInfo = data.result.realtime
    const weatherData: WeatherResponse = {
      city,
      date: new Date().toLocaleDateString('zh-CN'),
      temperature: weatherInfo.temperature,
      weather: weatherInfo.info,
      wind: `${weatherInfo.direct} ${weatherInfo.power}`,
      humidity: weatherInfo.humidity
    }

    return new Response(
      JSON.stringify(weatherData),
      { status: 200 }
    )
  } catch (error) {
    return new Response(
      JSON.stringify({
        error: 'æœåŠ¡å™¨å†…éƒ¨é”™è¯¯'
      }),
      { status: 500 }
    )
  }
}
```

</TabItem>
<TabItem label="åŸå¸‚æœç´¢æ¥å£">

```ts
// pages/api/weather/cities.ts
import type { APIRoute } from 'astro'

interface CitySearchResponse {
  cities: string[]
}

// æ¨¡æ‹ŸåŸå¸‚æ•°æ®åº“
const cityDatabase = [
  'åŒ—äº¬', 'ä¸Šæµ·', 'å¹¿å·', 'æ·±åœ³', 'æ­å·', 'å—äº¬', 'æˆéƒ½', 'æ­¦æ±‰',
  'è¥¿å®‰', 'é‡åº†', 'å¤©æ´¥', 'è‹å·', 'é•¿æ²™', 'éƒ‘å·', 'é’å²›', 'å¤§è¿',
  'å®æ³¢', 'å¦é—¨', 'ç¦å·', 'æµå—', 'åˆè‚¥', 'æ˜†æ˜', 'å“ˆå°”æ»¨', 'æ²ˆé˜³'
]

export const GET: APIRoute = async ({ request }) => {
  try {
    const url = new URL(request.url)
    const query = url.searchParams.get('query')

    if (!query) {
      return new Response(
        JSON.stringify({
          cities: []
        }),
        { status: 200 }
      )
    }

    // ç®€å•çš„æ¨¡ç³Šæœç´¢å®ç°
    const matchedCities = cityDatabase.filter(city =>
      city.toLowerCase().includes(query.toLowerCase())
    )

    const response: CitySearchResponse = {
      cities: matchedCities
    }

    return new Response(
      JSON.stringify(response),
      { status: 200 }
    )
  } catch (error) {
    return new Response(
      JSON.stringify({
        error: 'æœåŠ¡å™¨å†…éƒ¨é”™è¯¯'
      }),
      { status: 500 }
    )
  }
}
```

</TabItem>
</Tabs>

è¿™ä¸¤ä¸ª API ç«¯ç‚¹çš„åŠŸèƒ½è¯´æ˜ï¼š

1. å¤©æ°”æŸ¥è¯¢æ¥å£ (`/api/weather`)ï¼š
   - æ¥æ”¶åŸå¸‚åç§°ä½œä¸ºæŸ¥è¯¢å‚æ•°
   - è°ƒç”¨èšåˆæ•°æ®å¤©æ°” API è·å–å®æ—¶å¤©æ°”ä¿¡æ¯
   - è¿”å›æ ¼å¼åŒ–åçš„å¤©æ°”æ•°æ®

2. åŸå¸‚æœç´¢æ¥å£ (`/api/weather/cities`)ï¼š
   - æ¥æ”¶æœç´¢å…³é”®è¯ä½œä¸ºæŸ¥è¯¢å‚æ•°
   - åœ¨é¢„è®¾çš„åŸå¸‚æ•°æ®ä¸­è¿›è¡Œæ¨¡ç³Šæœç´¢
   - è¿”å›åŒ¹é…çš„åŸå¸‚åˆ—è¡¨